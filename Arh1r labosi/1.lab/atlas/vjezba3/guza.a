VJ1_DATA EQU 0FFFF1000
VJ2_DATA EQU 0FFFF2000
VJ2_BIST EQU 0FFFF2004
VJ3_DATA EQU 0FFFF3000
VJ3_IACK EQU 0FFFF3004
VJ3_IEND EQU 0FFFF3008
VJ3_STOP EQU 0FFFF300C

    ORG 0
    MOVE 10000, SP
    JP GLAVNI
    ORG 8
    DW 100

GLAVNI
    	MOVE %B 10000, SR
	MOVE 1, R0
	STORE R0, (VJ3_STOP)
LOOP
    LOAD R0, (VJ2_BIST) 
    OR R0, R0, R0
    JP_Z LOOP
    
    LOAD R0, (BROJ)
    STORE R0, (VJ2_DATA)
    STORE R0, (VJ2_BIST)
    LOAD R0, (COUNTER)
    ADD R0, 1, R0
    STORE R0, (COUNTER)
    JR LOOP
    
    ORG 100
    PUSH R0
    MOVE R0, SR
    PUSH R0
    STORE R0, (VJ3_IACK)
    LOAD R0, (VJ1_DATA)
    OR R0, R0, R0
    JP_N KRAJ
    PUSH R0
    CALL OBRADI
    STORE R0, (BROJ)
    LOAD R0, (COUNTER)
    STORE R0, (VJ3_DATA)
    ADD R7, 4, R7
    POP R0
    MOVE R0, SR
    POP R0
    STORE R0, (VJ3_IEND)
    RETI

KRAJ 
	MOVE 0, SR
	HALT
     
BROJ DW 0
COUNTER DW 0

OBRADI
    PUSH R1
    LOAD R1, (SP+8)
    MOVE %D 2, R0
	SUB R1, 1, R1
    SHL R0, R1, R0
    POP R1
    RET

