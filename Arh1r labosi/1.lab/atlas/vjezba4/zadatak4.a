CTCR EQU 0FFFF0000
CTLR EQU 0FFFF0004
CTACK EQU 0FFFF0008
CTEND EQU 0FFFF000C
DMA_SRC EQU 0FFFF1000
DMA_DEST EQU 0FFFF1004
DMA_SIZE EQU 0FFFF1008
DMA_CTRL EQU 0FFFF100C
DMA_START EQU 0FFFF1010
DMA_BS EQU 0FFFF1014
BVJ EQU 0FFFFFFFC

	ORG 0
	MOVE 10000, SP
	JP GLAVNI

	ORG 0C
	PUSH R0
	MOVE SR, R0
	PUSH R0
	STORE R0, (DMA_BS)
	SUB R2, 4, R0
	MOVE -1, R1
	STORE R1, (R0)
	LOAD R0, (BLOKOVI)
	ADD R0, 1, R0
	STORE R0, (BLOKOVI)
	POP R0
	MOVE R0, SR
	POP R0
	
	RETN
	
GLAVNI
	MOVE 1000, R2
	MOVE %D 1000, R0
	STORE R0, (CTLR)
	MOVE 1, R0
	STORE R0, (CTCR)
PETLJA
	LOAD R0, (BLOKOVI)
	CMP R0, 5
	JP_EQ KRAJ
	
	LOAD R0, (CTACK)
	AND R0, 1, R0
	JR_Z PETLJA
	
	STORE R0, (CTACK)

	
	MOVE 0FFFFFFFC, R0
	STORE R0, (DMA_SRC)
	STORE R2, (DMA_DEST)
	ADD R2, 28, R2
	MOVE 9, R0
	STORE R0, (DMA_SIZE)
	MOVE %B 0111, R0
	STORE R0, (DMA_CTRL)
	STORE R0, (DMA_START)
	STORE R0, (CTEND)
	JP PETLJA
	
	

KRAJ
	MOVE 0, R0
	STORE R0, (CTCR)
	STORE R0, (DMA_CTRL)
	HALT



BLOKOVI DW 0