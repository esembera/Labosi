CTCR	EQU	0FFFF0000
CTLR	EQU	0FFFF0004
CTSTAT	EQU	0FFFF0008
CTEND	EQU	0FFFF000C

BVJDATA	EQU	0FFFFFFFC

DMASRC	EQU	0FFFF1000
DMADEST	EQU	0FFFF1004
DMACNT	EQU	0FFFF1008
DMACTRL	EQU	0FFFF100C
DMASTART	EQU	0FFFF1010
DMAIACK	EQU	0FFFF1014

	ORG 0
	MOVE 10000, SP
	JP GLAVNI
	
	ORG 0C
	PUSH R0
	MOVE SR, R0
	PUSH R0
	PUSH R2
	STORE R0, (DMAIACK)
	MOVE -1, R2
	SUB R1, 4, R0
	STORE R2, (R0)
	LOAD R0, (BLOKOVI)
	ADD R0, 1, R0
	STORE R0, (BLOKOVI)
	POP R2
	POP R0
	MOVE R0, SR
	POP R0
	RETN
	
GLAVNI
	MOVE 1000, R1
	MOVE %D 1000, R0
	STORE R0, (CTLR)
	MOVE 1, R0
	STORE R0, (CTCR)
LOOP
	LOAD R0, (BLOKOVI)
	CMP R0, 6
	JR_EQ KRAJ
	
	LOAD R0, (CTSTAT)
	AND R0, 1, R0
	JR_Z LOOP
	
	STORE R0, (CTSTAT)
	
	MOVE BVJDATA, R0
	STORE R0, (DMASRC)
	STORE R1, (DMADEST)
	ADD R1, 28, R1
	MOVE 9, R0
	STORE R0, (DMACNT)
	MOVE %B 111, R0
	STORE R0, (DMACTRL)
	
	STORE R0, (DMASTART)
	STORE R0, (CTEND)
	JR LOOP
	
KRAJ
	MOVE 0, R0
	STORE R0, (CTCR)
	STORE R0, (DMACTRL)
	HALT
		
BLOKOVI DW 1